<div class="container">
  <h1 class="my-5 text-center">Thực đơn hiện tại</h1>

  <div class="category-list">
    <div
      class="category-item"
      [class.active]="prm.categoryId === 0"
      (click)="selectCategory(0)"
    >
      Tất cả
    </div>
    @for (c of categories; track $index) {
    <div
      class="category-item"
      [class.active]="prm.categoryId === c.id"
      (click)="selectCategory(c.id)"
    >
      {{ c.name }}
    </div>
    }
  </div>
  <div class="search-box">
    <form (ngSubmit)="onSearch()" autocomplete="off">
      <nz-input-group [nzSuffix]="suffixIconSearch">
        <input
          type="text"
          nz-input
          placeholder="Nhập tên sản phẩm"
          [(ngModel)]="prm.search"
          name="search"
        />
      </nz-input-group>
      <ng-template #suffixIconSearch>
        <span nz-icon nzType="search"></span>
      </ng-template>
    </form>
  </div>

  <div class="product-grid">
    @if (items) { @for (item of items.data; track item.id) {
    <nz-card style="cursor: pointer" (click)="showModal(item.id)">
      <div class="d-flex flex-column gap-3">
        <img [src]="item.imgUrl" [alt]="item.name" class="product-image" />
        <div nz-tooltip nzTooltipTitle="{{ item.name }}" class="item-name">
          {{ item.name }}
        </div>
        <div class="item-price">
          Giá:
          <span class="fw-medium">{{
            utilService.formatVND(item.sizes[0].price)
          }}</span>
        </div>
      </div>
    </nz-card>
    } }
  </div>
  <div
    *ngIf="items != null"
    class="d-flex align-items-center justify-content-center mt-3"
  >
    <nz-pagination
      [nzPageIndex]="items.pageIndex"
      [nzTotal]="items.count"
      [nzSize]="'default'"
      [nzPageSize]="items.pageSize"
      (nzPageIndexChange)="onPageIndexChange($event)"
      (nzPageSizeChange)="onPageSizeChange($event)"
      [nzShowTotal]="totalTemplate"
      [nzShowSizeChanger]="true"
      [nzShowQuickJumper]="true"
      [nzPageSizeOptions]="[3, 5, 10, 20, 50]"
    ></nz-pagination>
    <ng-template #totalTemplate let-total
      >Tổng {{ total }} sản phẩm</ng-template
    >
  </div>

  <!-- modal item -->
  <nz-modal
    [(nzVisible)]="isVisible"
    nzTitle="Thông tin sản phẩm"
    (nzOnCancel)="handleCancel()"
    nzWidth="720px"
    [nzFooter]="null"
  >
    <ng-container *nzModalContent>
      <div *ngIf="item" class="d-flex gap-3">
        <img
          nz-image
          [nzSrc]="item.imgUrl"
          [alt]="item.name"
          width="250px"
          height="auto"
          style="object-fit: cover; cursor: pointer"
        />

        <div class="d-flex flex-column gap-3 w-100">
          <div
            nz-tooltip
            nzTooltipTitle="{{ item.name }}"
            class="item-name p-0 text-start"
            style="font-size: 20px; max-width: 400px"
          >
            {{ item.name }}
          </div>

          <div class="size-selection">
            <nz-radio-group
              [ngModel]="size"
              (ngModelChange)="onSizeChange($event)"
            >
              @for (size of item.sizes; track size.id) {
              <div class="d-flex flex-column">
                <label
                  *ngIf="size.newPrice"
                  nz-radio
                  [nzValue]="size"
                  class="mb-2"
                >
                  {{ size.name }} -
                  <span class="line-through">{{
                    utilService.formatVND(size.price)
                  }}</span>

                  -
                  <span class="fw-medium" style="color: var(--danger)">
                    {{ utilService.formatVND(size.newPrice) }}</span
                  >
                </label>

                <label
                  *ngIf="!size.newPrice"
                  nz-radio
                  [nzValue]="size"
                  class="mb-2"
                >
                  {{ size.name }} -
                  {{ utilService.formatVND(size.price) }}
                </label>
              </div>
              }
            </nz-radio-group>
          </div>

          <div class="d-flex gap-3 align-items-center justify-content-center">
            <label for="quantity" class="fw-medium">Số lượng: </label>
            <input
              class="w-75"
              nz-input
              placeholder="Số lượng"
              [(ngModel)]="quantity"
              type="number"
              id="quantity"
            />
          </div>
        </div>
      </div>
      <div *ngIf="item?.description" class="mt-3" style="font-size: 18px">
        <span class="fw-medium"> Chú thích: </span>{{ item?.description }}
      </div>

      <hr />
      <div class="d-flex gap-2 justify-content-end">
        <button nz-button type="button" (click)="handleCancel()">Đóng</button>
        <button type="button" nz-button nzType="primary" (click)="addToCart()">
          Thêm
        </button>
      </div>
    </ng-container>
  </nz-modal>
</div>
